<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bisonR">
<title>Using brms with BISoN â€¢ bisonR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using brms with BISoN">
<meta property="og:description" content="bisonR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bisonR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>bisonR</h6>
    <a class="dropdown-item" href="../articles/getting_started.html">Getting started</a>
    <a class="dropdown-item" href="../articles/bison_brms.html">Using brms with BISoN</a>
    <a class="dropdown-item" href="../articles/mixture_models.html">Edge mixture models</a>
    <a class="dropdown-item" href="../articles/network_metrics.html">Network metrics</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Help</h6>
    <a class="dropdown-item" href="../articles/windows_installation.html">Installing cmdstanR on Windows</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JHart96/bisonR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using brms with BISoN</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JHart96/bisonR/blob/HEAD/vignettes/bison_brms.Rmd" class="external-link"><code>vignettes/bison_brms.Rmd</code></a></small>
      <div class="d-none name"><code>bison_brms.Rmd</code></div>
    </div>

    
    
<p>bisonR can fully integrate with the popular Bayesian modelling
package <code>brms</code>. This means that any brms model can be fit to
network data such as edge weights, node centrality, or even global
metrics comparing networks. This is achieved by treating network
posteriors as imputed data and running multiple Bayesian models on these
imputed data. This function is implemented as <code>bison_brm</code> and
uses largely the same arguments as brms. The function returns an object
of type <code>brm_multiple</code>.</p>
<p>bisonR uses a special notation to include network data in a brms
formula. To specify network data, the wrapper <code>bison()</code> is
used to tell the function that this variable should come from network
data with uncertainty. Network properties can be calculated at three
different levels: edge, node, and global. See the
<code>network_metrics</code> vignette for information on available
metrics. Depending on the type of analysis, you will need to specify
node IDs or network IDs to ensure the data in your dataframe align with
the network properties calculated in bisonR. This information is
included as arguments to the network property in the formula.</p>
<p>When running analyses comparing global properties of networks,
multiple fitted edge models must be provided, corresponding to each
network. <code>bisonR</code> introduces a preserved factor variable
<code>bison_network</code> that can be used to reference the different
networks. <code>bison_network</code> is an integer factor corresponding
to the order that fitted edge models were provided to
<code>bison_brm</code>.</p>
<p>This sounds a little complex, but is much easier to understand with
examples. The table below shows some examples of how the analysis would
be conducted in brms (or lm/lmer/etc) compared to
<code>bison_brm</code>.</p>
<table class="table">
<thead><tr class="header">
<th>Standard formula</th>
<th>bison_brm formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>edge_weight ~ x</code></td>
<td><code>bison(edge_weight(node_1_id, node_2_id)) ~ x</code></td>
</tr>
<tr class="even">
<td><code>y ~ edge_weight</code></td>
<td><code>y ~ bison(edge_weight(node_1_id, node_2_id))</code></td>
</tr>
<tr class="odd">
<td><code>strength ~ x</code></td>
<td><code>bison(strength(node_id)) ~ x</code></td>
</tr>
<tr class="even">
<td><code>y ~ strength</code></td>
<td><code>y ~ bison(strength(node_id))</code></td>
</tr>
<tr class="odd">
<td><code>cv ~ x</code></td>
<td><code>global_cv(bison_network) ~ x</code></td>
</tr>
<tr class="even">
<td><code>y ~ cv</code></td>
<td><code>y ~ global_cv(bison_network)</code></td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="dyadic-regression">Dyadic regression<a class="anchor" aria-label="anchor" href="#dyadic-regression"></a>
</h3>
<div class="section level4">
<h4 id="edge-weight-as-response">Edge weight as response<a class="anchor" aria-label="anchor" href="#edge-weight-as-response"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">edge_weight</span><span class="op">(</span><span class="va">node_1_id</span>, <span class="va">node_2_id</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">age_diff</span>,</span>
<span>  <span class="va">fit_edge</span>,</span>
<span>  <span class="va">df_edge</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="edge-weight-as-predictor">Edge weight as predictor<a class="anchor" aria-label="anchor" href="#edge-weight-as-predictor"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="va">mass</span> <span class="op">~</span> <span class="fu">bison</span><span class="op">(</span><span class="fu">edge_weight</span><span class="op">(</span><span class="va">node_1_id</span>, <span class="va">node_2_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">fit_edge</span>,</span>
<span>  <span class="va">df_edge</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="edge-weight-as-response-with-multiple-networks">Edge weight as response with multiple networks<a class="anchor" aria-label="anchor" href="#edge-weight-as-response-with-multiple-networks"></a>
</h4>
<p>When analysing multiple networks, we need to provide multiple fitted
edge models and corresponding dataframes. If the network IDs are to be
used, we can access them using the preserved variable
<code>bison_network</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">edge_weight</span><span class="op">(</span><span class="va">node_1_id</span>, <span class="va">node_2_id</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">bison_network</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit_edge_control</span>, <span class="va">fit_edge_treatment</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">df_edge_control</span>, <span class="va">df_edge_treatment</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="nodal-regression">Nodal regression<a class="anchor" aria-label="anchor" href="#nodal-regression"></a>
</h3>
<div class="section level4">
<h4 id="node-metric-as-a-predictor">Node metric as a predictor<a class="anchor" aria-label="anchor" href="#node-metric-as-a-predictor"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="va">trait</span> <span class="op">~</span> <span class="fu">bison</span><span class="op">(</span><span class="fu">node_eigen</span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">fit_edge</span>,</span>
<span>  <span class="va">df_nodal</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="node-metric-as-a-response">Node metric as a response<a class="anchor" aria-label="anchor" href="#node-metric-as-a-response"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">node_eigen</span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  <span class="va">fit_edge</span>,</span>
<span>  <span class="va">df_nodal</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="node-metric-as-a-response-controlling-for-network-id">Node metric as a response, controlling for network ID<a class="anchor" aria-label="anchor" href="#node-metric-as-a-response-controlling-for-network-id"></a>
</h4>
<p>If running an analysis across multiple networks, it might sometimes
be necessary to control for network ID. This could be done using a
random effect (varying intercept) as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">node_eigen</span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">bison_network</span><span class="op">)</span>,</span>
<span>  <span class="va">fit_edge_list</span>,</span>
<span>  <span class="va">df_nodal_list</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="global-regression">Global regression<a class="anchor" aria-label="anchor" href="#global-regression"></a>
</h3>
<div class="section level4">
<h4 id="global-metric-as-a-response">Global metric as a response<a class="anchor" aria-label="anchor" href="#global-metric-as-a-response"></a>
</h4>
<p>When running regression on global metrics, the fitted edge models
must again be provided as a list. However, the dataframes can be
provided either as 1) a list where each dataframe has one row,
describing its corresponding edge model or 2) a dataframe, where each
row in the dataframe corresponds to an edge model (where ordering is
maintained).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">global_cv</span><span class="op">(</span><span class="va">bison_network</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">bison_network</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit_edge_1</span>, <span class="va">fit_edge_2</span><span class="op">)</span>,</span>
<span>  <span class="va">df_global</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>The prior structure for a model (in the form of a
<code>brmsprior</code> object) can be retrieved using the
<code>bison_brm_get_prior</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bison_brm_get_prior.html">bison_brm_get_prior</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">global_cv</span><span class="op">(</span><span class="va">bison_network</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">bison_network</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit_edge_1</span>, <span class="va">fit_edge_2</span><span class="op">)</span>,</span>
<span>  <span class="va">df_global</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This object is a <code>brmsprior</code> object from the brms package,
and can be modified in exactly the same way. For example, from the brms
documentation, population-level fixed effects could be set all at once
using:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## define a prior on all population-level effects a once</span></span>
<span><span class="va">prior</span><span class="op">$</span><span class="va">prior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"normal(0,10)"</span></span></code></pre></div>
<p>Once priors are set, they can be fed to the <code>bison_brm</code>
function in the <code>prior=</code> argument, as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bison_brm.html">bison_brm</a></span><span class="op">(</span></span>
<span>  <span class="fu">bison</span><span class="op">(</span><span class="fu">global_cv</span><span class="op">(</span><span class="va">bison_network</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">bison_network</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit_edge_1</span>, <span class="va">fit_edge_2</span><span class="op">)</span>,</span>
<span>  <span class="va">df_global</span>,</span>
<span>  prior<span class="op">=</span><span class="va">prior</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>This is just a small subset of all the possible types of model that
can be fitted using the <code>bison_brm</code> function. For more
information on the wide range of functionality available, check out the
<a href="https://paul-buerkner.github.io/brms/" class="external-link">brms
documentation</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jordanhart.co.uk/" class="external-link">Jordan Hart</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
