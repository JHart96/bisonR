net <- graph_from_edgelist(as.matrix(df[, c("node_2_name", "node_1_name")]), directed=T)
E(net)$weight <- df$event/df$duration
cor(strength(net), x[1, ])
net <- graph_from_edgelist(as.matrix(df[, c("node_2_name", "node_1_name")]), directed=T)
E(net)$weight <- df$event/df$duration
cor(strength(net), x[1, ])
net <- graph_from_edgelist(as.matrix(df[, c("node_2_name", "node_1_name")]), directed=T)
E(net)$weight <- df$event/df$duration
cor(strength(net), x[1, ])
net <- graph_from_edgelist(as.matrix(df[, c("node_2_name", "node_1_name")]), directed=T)
E(net)$weight <- df$event/df$duration
cor(strength(net), x[1, ])
net <- graph_from_edgelist(as.matrix(df[, c("node_2_name", "node_1_name")]), directed=T)
E(net)$weight <- df$event/df$duration
cor(strength(net), x[1, ])
E(net)
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
x <- expect_warning(
extract_metric(fit_edge, "edge_weight", num_draws=10),
regexp=NA
)
expect_equal(dim(x)[1], 10)
x <- expect_warning(
extract_metric(fit_edge, "node_strength", num_draws=50),
regexp=NA
)
expect_equal(dim(x)[1], 50)
net <- bison_to_igraph(fit_edge, 2)[[1]]
expect_true(cor(igraph::strength(net), x[1, ]) > 0)
x <- expect_error(
extract_metric(fit_edge, "not_a_metric", standardise=TRUE)
)
x <- expect_warning(
extract_metric(fit_edge, "node_strength", standardise=TRUE),
regexp=NA
)
x <- expect_warning(
extract_metric(fit_edge, "node_betweenness"),
regexp=NA
)
x <- expect_warning(
extract_metric(fit_edge, "node_eigen"),
regexp=NA
)
x <- expect_warning(
extract_metric(fit_edge, "node_degree[0.2]"),
regexp=NA
)
extract_metric(fit_edge, "node_degree[0.2]")
x <- expect_warning(
extract_metric(fit_edge, "node_degree[0]"),
regexp=NA
)
x
x <- expect_warning(
extract_metric(fit_edge, "node_degree[0.2]"),
regexp=NA
)
x
devtools::load_all(".")
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
x <- expect_warning(
extract_metric(fit_edge, "edge_weight", num_draws=10),
regexp=NA
)
expect_equal(dim(x)[1], 10)
x <- expect_warning(
extract_metric(fit_edge, "node_strength", num_draws=50),
regexp=NA
)
x
qnorm(0.975)
devtools::load_all(".")
library(dplyr)
library(igraph)
set.seed(123)
# Load data in with minimal effects
sim_data <- simulate_bison_model("binary", aggregated = TRUE, location_effect = FALSE, age_diff_effect = FALSE)
df <- sim_data$df_sim
df$group_id <- sample(1:4, nrow(df), replace=TRUE)
priors = get_default_priors("binary")
expect_warning(
prior_check(priors, "binary"),
regexp=NA
)
expect_warning(
prior_predictive_check(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary",
priors=priors
),
regexp=NA
)
# Fit model to the data
fit_edge <- expect_warning(
bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id) + age_diff + (1 | group_id),
data=df,
model_type="binary"
),
regexp=NA
)
# Fit model to the data
fit_pool <- expect_warning(
bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary",
partial_pooling=TRUE,
zero_inflated=TRUE
),
regexp=NA
)
fit_null <- expect_warning (
bison_model(
(event | duration) ~ 1,
data=df,
model_type="binary",
priors=get_default_priors("binary")
),
regexp=NA
)
fit_compare <- suppressWarnings(model_comparison(list(non_random_model=fit_edge, random_model=fit_null)))
expect_output(print(fit_compare))
# Extract estimates and true values.
true <- sim_data$df_true %>%
mutate(edge_weight=edge_weight) %>%
select(node_1=node_1_id, node_2=node_2_id, true=edge_weight)
est <- get_edgelist(fit_edge, transform=FALSE) %>%
select(node_1, node_2, est=median, est_lb="5%", est_ub="95%")
comparison <- left_join(true, est, by=c("node_1", "node_2"))
# Calculate correlation between estimates and true values.
proportion_within_ci <- mean(comparison$true < comparison$est_ub & comparison$est > comparison$est_lb)
expect_gt(proportion_within_ci, 0.9)
# Check that plots don't produce warnings
expect_warning(plot_predictions(fit_edge), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10), regexp=NA)
devtools::load_all(".")
expect_warning(plot_network(fit_edge, lwd=10), regexp=NA)
expect_warning(plot_trace(fit_edge, par_ids=1), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=1), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.1), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.01), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.05), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.1), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.2), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.1), regexp=NA)
expect_warning(plot_network(fit_edge, lwd=10, threshold=0.1), regexp=NA)
devtools::load_all(".")
gbi <- matrix(rbinom(20 * 10, 1, 0.25), 20, 10)
gbi <- matrix(rbinom(20 * 10, 1, 0.25), 20, 10)
df <- convert_gbi_to_bison(gbi)
# Correct length
expect_true(nrow(df) == 20 * 10 * 9 * 0.5)
df
df[30, ]
row <- df[30, ]
row[4]
gbi[row[4], c(row[1], row[2])]
c(row[1], row[2])
row[1]
gbi[row[4], row[1]]
row[1]
row <- as.numeric(df[30, ])
gbi[row[4], row[1]]
gbi[row[4], row[1]] * gbi[row[4], row[2]]
row[3]
gbi <- matrix(rbinom(20 * 10, 1, 0.25), 20, 10)
df <- convert_gbi_to_bison(gbi)
# for (i in 1:nrow(df)) {
#   row_correct <- gbi[row[4], row[1]] * gbi[row[4], row[2]] == row[3]
#   if (row_correct == FALSE) {
#     break
#   }
# }
# expect_true(row)
# Correct length
# expect_true(nrow(df) == 20 * 10 * 9 * 0.5)
# Entries are correct
results <- rep(0, nrow(df))
for (i in 1:nrow(df)) {
results[i] <- gbi[ df[i, ]$group_id, df[i, ]$node_1] * gbi[ df[i, ]$group_id, df[i, ]$node_2] == df[i, ]$event
}
expect_true(all(results == TRUE))
all(results == TRUE)
gbi <- matrix(rbinom(200 * 10, 1, 0.25), 200, 10)
df <- convert_gbi_to_bison(gbi)
time()
start_time <- Sys.time()
start_time <- Sys.time()
df <- convert_gbi_to_bison(gbi)
Sys.time() - start_time
start_time <- Sys.time()
df <- convert_gbi_to_bison(gbi)
Sys.time() - start_time
gbi <- matrix(rbinom(200 * 10, 1, 0.25), 200, 10)
df <- convert_gbi_to_bison(gbi)
start_time <- Sys.time()
df <- convert_gbi_to_bison(gbi)
Sys.time() - start_time
gbi <- matrix(rbinom(200 * 10, 1, 0.25), 200, 10)
df <- convert_gbi_to_bison(gbi)
start_time <- Sys.time()
df <- convert_gbi_to_bison(gbi)
Sys.time() - start_time
gbi <- matrix(rbinom(200 * 10, 1, 0.25), 200, 10)
df <- convert_gbi_to_bison(gbi)
start_time <- Sys.time()
df <- convert_gbi_to_bison(gbi)
Sys.time() - start_time
devtools::document()
devtools::install()
devtools::load_all(".")
devtools::test_active_file()
devtools::test_active_file()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
tidy.opts=list(width.cutoff=80),
tidy=TRUE
)
library(bisonR)
library(dplyr)
sim_data <- simulate_bison_model("binary", aggregated = FALSE)
df <- sim_data$df_sim
head(df)
priors <- get_default_priors("binary")
priors
prior_check(priors, "binary")
priors$edge <- "normal(-1, 2.5)"
prior_check(priors, "binary")
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary",
priors=priors
)
plot_trace(fit_edge, par_ids=2)
plot_predictions(fit_edge, num_draws=20, type="density")
plot_predictions(fit_edge, num_draws=20, type="point")
summary(fit_edge)
plot_network(fit_edge, lwd=5)
fit_null <- bison_model(
(event | duration) ~ 1,
data=df,
model_type="binary",
priors=priors
)
model_comparison(list(non_random_model=fit_edge, random_model=fit_null))
df_dyadic <- df %>%
distinct(node_1_id, node_2_id, age_diff)
df_dyadic
fit_dyadic <- bison_brm (
bison(edge_weight(node_1_id, node_2_id)) ~ age_diff,
fit_edge,
df_dyadic,
num_draws=5, # Small sample size for demonstration purposes
refresh=0
)
summary(fit_dyadic)
cv_samples <- extract_metric(fit_edge, "global_cv")
head(cv_samples)
plot(density(cv_samples))
cv_samples <- extract_metric(fit_edge, "global_diameter")
head(cv_samples)
extract_metric(fit_edge, "global_diameter")
extract_metric(fit_edge, "global_clustering")
devtools::load_all(".")
extract_metric(fit_edge, "global_clustering")
extract_metric(fit_edge, "global_clustering")
devtools::load_all(".")
extract_metric(fit_edge, "global_clustering")
extract_metric(fit_edge, "global_clustering")
extract_metric(fit_edge, "global_clustering")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
extract_metric(fit_edge, "node_clustering[0.2]")
extract_metric(fit_edge, "node_degree[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_degree[0.2]")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "node_clustering[0.2]")
devtools::load_all(".")
extract_metric(fit_edge, "global_clustering[0.2]")
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
```
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
dim(metrics)
dim(metrics)
dim(metrics)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
dim(metrics)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
dim(metrics)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
head(metrics)
head(metrics[, 1:3])
head(metrics[, :6])
head(metrics[, 1:6])
head(metrics[:, 1:6]) # Show first
head(metrics) # Show first
metrics[1:6,1:4] # Preview first few samples and nodes
metrics[1:6,1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_strength", num_draws=10)
metrics[1:6,1:5] # Preview first few samples and nodes
metrics[1:6,1:5] # Preview first few samples and nodes
extract_metric(fit_edge, "node_betweenness")
metrics[1:6,1:5] # Preview first few samples and nodes
extract_metric(fit_edge, "node_betweenness")
metrics[1:6,1:5] # Preview first few samples and nodes
extract_metric(fit_edge, "node_betweenness")
metrics[1:6,1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_betweenness")
metrics[1:6,1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_eigen")
metrics[1:6,1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_degree[0.2]")
metrics[1:6,1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_closeness")
metrics[1:6, 1:5] # Preview first few samples and nodes
devtools::load_all(".")
metrics <- extract_metric(fit_edge, "node_clustering[0.2]")
metrics[1:6, 1:5]
metrics <- extract_metric(fit_edge, "node_cv")
metrics <- extract_metric(fit_edge, "global_cv")
metrics[1:6, 1:5]
metrics <- extract_metric(fit_edge, "global_cv")
metrics[1:6]
metrics <- extract_metric(fit_edge, "global_density")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[0.2]")
metrics[1:6] # Preview first few samples
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
tidy.opts=list(width.cutoff=80),
tidy=TRUE
)
library(bisonR)
library(dplyr)
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and edges
metrics <- extract_metric(fit_edge, "node_strength", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_degree[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_eigen")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_betweenness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_closeness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_clustering[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "global_cv")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_density")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_std")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_diameter")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[0.2]")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[-0.5]")
metrics[1:6] # Preview first few samples
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
tidy.opts=list(width.cutoff=80),
tidy=TRUE
)
library(bisonR)
library(dplyr)
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and edges
metrics <- extract_metric(fit_edge, "node_strength", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_degree[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_eigen")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_betweenness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_closeness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_clustering[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "global_cv")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_density")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_std")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_diameter")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[-0.5]")
metrics[1:6] # Preview first few samples
metrics # Preview first few samples
devtools::load_all(".")
devtools::load_all(".")
metrics <- extract_metric(fit_edge, "global_clustering[-0.5]")
metrics # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[0.2]")
metrics # Preview first few samples
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
tidy.opts=list(width.cutoff=80),
tidy=TRUE
)
library(bisonR)
library(dplyr)
sim_data <- simulate_bison_model("binary", aggregated = TRUE)
df <- sim_data$df_sim
fit_edge <- bison_model(
(event | duration) ~ dyad(node_1_id, node_2_id),
data=df,
model_type="binary_conjugate",
priors=get_default_priors("binary_conjugate")
)
metrics <- extract_metric(fit_edge, "edge_weight", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and edges
metrics <- extract_metric(fit_edge, "node_strength", num_draws=10)
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_degree[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_eigen")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_betweenness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_closeness")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "node_clustering[0.2]")
metrics[1:6, 1:5] # Preview first few samples and nodes
metrics <- extract_metric(fit_edge, "global_cv")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_density")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_std")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_diameter")
metrics[1:6] # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[0.2]")
metrics # Preview first few samples
metrics <- extract_metric(fit_edge, "global_clustering[0.2]")
metrics[1:6] # Preview first few samples
devtools::install()
devtools::install()
devtools::test()
devtools::test()
devtools::build_vignettes()
remotes::install_github("JHart96/bisonR")
